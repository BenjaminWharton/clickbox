<!DOCTYPE html>
<html lang="en" onmousedown="MouseDown()" onmouseup="MouseUp()" onmouseleave="MouseExit()" oncontextmenu="return false;">
  <head>
    <script src="javascript.js"></script>	
    <link rel="stylesheet" href="css/clickboxStyles.css">
    <script>
	
class TriangleButton extends GameButton {
	constructor(x, y, Facing) {
	  	super(x, y, Facing);
		this.btn.btnWall = "images/TriangleWall.png";
		this.btn.classList.add("triangle");
		this.btn.svgBg.classList.add("triangle");
		this.btn.svgL.classList.add("triangle");
		this.btn.svgL.setAttribute("viewBox", "-20 -25 120 120");

		if (Facing == "down") {
		    this.btn.style.transform = "translate(" + x + "px,"+ (y - 11) + "px)";
			this.btn.svgM.style.transform = "translate(" + x + "px,"+ (y - 11) + "px)";
		    this.btn.svgBg.style.transform = "translate(" + x + "px,"+ y + "px)" + "rotate(180deg)";
			this.btn.svgL.style.transform = "translate(" + x + "px,"+ y + "px)" + "rotate(180deg)";
		} else {
		    this.btn.style.transform = "translate(" + x + "px,"+ (y + 11) + "px)";	
            this.btn.svgM.style.transform = "translate(" + x + "px,"+ (y + 11) + "px)";			
		}		  
	}

    createHitbox(svg, hitbox) {
	    let point = svg.createSVGPoint();
	    point.x = 40;
	    point.y = 6;
	    hitbox.points.appendItem(point);
	    point = svg.createSVGPoint();
	    point.x = 79;
	    point.y = 74;
	    hitbox.points.appendItem(point);
	    point = svg.createSVGPoint();
	    point.x = 1;
	    point.y = 74;
	    hitbox.points.appendItem(point);
	    point = svg.createSVGPoint();						
	}

    createModifier(modifier) {
        modifier.setAttribute("r","14px");
        modifier.setAttribute("cx","40px");
        modifier.setAttribute("cy","40px");		
	}

    defineArea() {
	      let midBtn = this.btn;
	      for (let i = 0; i < GameButtons.length; i++) {
		    let btn = GameButtons[i].btn;
			let x = btn.offsetx - midBtn.offsetx;
			let y = btn.offsety - midBtn.offsety;
			let nw = 85;
			let ew = 85;
			let ww = 85;			
			if (midBtn.walls.includes("n")) {
			  nw = 0;		
			}
			if (midBtn.walls.includes("e")) {
			  ew = 0;		
			}
			if (midBtn.walls.includes("w")) {
			  ww = 0;		
			}
	

			if (midBtn.facing == "up") {
		      if (y > x*(44/25) - 16 - ew*2 &&
		          y > x*(-44/25) - 16 - ww*2 &&
			      y < 8 + nw &&
				  y > -85 &&
				  x < 85 &&
				  x > -85) {
                midBtn.affectedButtons.push(btn);
		      }			
			} else {
		      if (y < x*(44/25) + 16 + ww*2 &&
		          y < x*(-44/25) + 16 + ew*2 &&
			      y > -8 - nw &&
				  y < 85 &&
				  x > -85 &&
				  x < 85) {
                midBtn.affectedButtons.push(btn);			
              }				
			}
		  }		
	}
	
	  addWall (String) {
	    let btn = this.btn;
	    if (String.includes("n") == true) {
		  if (btn.walls.includes("n") == false) {
		    let nWall = document.createElement('img');
			btn.nWall = nWall;
		    nWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(nWall);
		    nWall.src = btn.btnWall;
			nWall.style.position = "absolute"
			if (this.btn.facing == "up") {
			  nWall.style.transform = "translate(" + (this.btn.offsetx + 10) + "px,"+ (this.btn.offsety + 15) + "px)" + "rotate(180deg)";
			} else {
			  nWall.style.transform = "translate(" + (this.btn.offsetx + 10) + "px,"+ (this.btn.offsety + 6) + "px)";
			}
			btn.walls = btn.walls + "n";
		  }
		}
	    if (String.includes("w") == true) {
		  if (btn.walls.includes("w") == false) {
		    let wWall = document.createElement('img');
			btn.wWall = wWall;
		    wWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(wWall);
		    wWall.src = btn.btnWall;
			wWall.style.position = "absolute"
			if (this.btn.facing == "up") {
              wWall.style.transform = "translate(" + (this.btn.offsetx + 16) + "px,"+ (this.btn.offsety + 25) + "px)" + "rotate(300deg)";
			} else {
			  wWall.style.transform = "translate(" + (this.btn.offsetx + 16) + "px,"+ (this.btn.offsety - 5) + "px)" + "rotate(240deg)";
			}
			btn.walls = btn.walls + "w";
		  }
		}
	    if (String.includes("e") == true) {
		  if (btn.walls.includes("e") == false) {
		    let eWall = document.createElement('img');
			btn.eWall = eWall;
		    eWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(eWall);
		    eWall.src = btn.btnWall;
			eWall.style.position = "absolute"
			if (this.btn.facing == "up") {
			  eWall.style.transform = "translate(" + (this.btn.offsetx + 4) + "px,"+ (this.btn.offsety + 25) + "px)" + "rotate(60deg)";
			} else {
			  eWall.style.transform = "translate(" + (this.btn.offsetx + 4) + "px,"+ (this.btn.offsety - 5) + "px)" + "rotate(120deg)";
			}
			btn.walls = btn.walls + "e";
		  }
		}
	  }

      randomWall(none=false) {
	      let rand = null;
	      if (none == false) {
		      rand = Math.trunc(Math.random()*3);		  
		  } else {
		      rand = Math.trunc(Math.random()*4);			  
		  }

		  if (rand == 0) {
		    return "n";
		  } else if (rand == 1) {
		    return "e";
		  } else if (rand == 2) {
		    return "w";
		  } else {
		    return "";
		  }
	  }	 

}	  
  

      function GenerateLevelNum (Level) {
        if (Level == 1) {                      /////////////////// Level 1
		  GenerateLevel(size*size/5);		
		} else if (Level == 2) {	           ////////////////// Level 2
		  GenerateLevel(size*size/3);		
		} else if (Level == 3) {              ////////////////// Level 3
		  GenerateLevel(size*size/2);		
		} else if (Level == 4) {              ////////////////// Level 4
		  let rand = RandomButtonFactor();
		  for (i = 0; i < GameButtons.length; i++) {
		    let gbtn = GameButtons[i];
		    if (gbtn.btn.facing == "up") {
			  gbtn.changeFactor(rand);
			}
		  }
		  GenerateLevel(size*size/2);  //////////////// Level 4
		} else if (Level == 5) {              //////////////// Level 5
		  let rand = RandomButtonFactor();
		  for (i = 0; i < GameButtons.length; i++) {
			GameButtons[i].changeFactor(rand);
		  }
		  GenerateLevel(size*size/2); ///////////////// Level 5
		} else if (Level == 6) {              //////////////// Level 6
		  for (i = 0; i < GameButtons.length; i++) {
		  	let rand = RandomButtonFactor();
			GameButtons[i].changeFactor(rand);
		  }
		  GenerateLevel(size*size/2); ///////////////// Level 6
		} else if (Level == 7) {              //////////////// Level 7
		  let rand = Math.trunc(Math.random()*2) + 3;
		  for (i = 0; i < GameButtons.length; i++) {
		    rand = rand - 1;
			if (rand <= 0) {
			  GameButtons[i].addWall(GameButtons[i].randomWall());	
              rand = Math.trunc(Math.random()*2) + 3;			  
			}
		  }
		  GenerateLevel(size*size/2); ///////////////// Level 7
		} else if (Level == 8) {              //////////////// Level 8
		  for (i = 0; i < GameButtons.length; i++) {
            if (GameButtons[i].btn.facing == "down") {
			  GameButtons[i].addWall(GameButtons[i].randomWall());		
			}
		  }
		  GenerateLevel(size*size/2); ///////////////// Level 8
		} else if (Level == 9) {              //////////////// Level 9
		  let rand = GameButtons[0].randomWall();
		  for (i = 0; i < GameButtons.length; i++) {
			  GameButtons[i].addWall(rand);		
		  }
		  GenerateLevel(size*size/2); ///////////////// Level 9
		} else {
		  InitializeButtonGroups();
		}
	  }
	  
	  function NewLevel(){
	    let rand = 0;
		let i = 0;
		let clicks = 0;
        DestroyGrid();
		let grid = document.createElement ('div');
		grid.id = "grid-container";
		document.getElementById("demo").appendChild(grid);
		document.getElementById("new-level").innerHTML = "New Level";
		if (parseInt(document.getElementById("level-size").value) < 3){
		  document.getElementById("level-size").value = 3;
		}
		if (parseInt(document.getElementById("level-size").value) > 30){
		  document.getElementById("level-size").value = 30;
		}
	  	size = parseInt(document.getElementById("level-size").value);
		i = 0;
	    for (let y = 0; y < size; y++) {	
          for (let x = 0; x < 1 + y*2; x++){
            i++;	  
	        if (x%2 == 0) { 
              GameButtons.push(new TriangleButton(-40 + (40*x - y*40), y*69, "up"));
	        } else {
			  GameButtons.push(new TriangleButton(-40 + (40*x - y*40), y*69, "down"));
	        }
	      }  
	      x = 0;
        }
		GenerateLevelNum(document.getElementById("level-number").value);
		document.getElementById("dummy").style.height = size*69 + "px";
      }	  

    </script>
  </head>
  <body>
    <main>	  	  
	  <nav class="menu">
        <div>
		   <span class="menu-button"><a href="index.html">Square</a></span>
           <span><strong>Triangle</strong></span>
		   <span class="menu-button"><a href="clickboxPentagon.html">Pentagon</a></span>
		   <span class="menu-button"><a href="clickboxHexagon.html">Hexagon</a></span>
        </div>
      </nav>	  
	  
	  
	<div class="demo" id="demo">
	  <div>
	    <input type="number" class="level-number" id="level-number" value="1" min="1" max="9">
	    <button class="new-level" id="new-level" onclick="NewLevel()" >New Level</button>
	    <input type="number" class="level-size" id="level-size" value="5" min="3" max="30">
	  </div>
      <div><button class="reset" onclick="ResetClick()">Reset</button></div>
	</div>
	<div id="dummy"></div>	  
    </main>
	
    <script>
	NewLevel();
	  
	</script>  	
	
	
  </body>
</html>
