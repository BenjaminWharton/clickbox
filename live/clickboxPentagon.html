<!DOCTYPE html>
<html lang="en" onmousemove="StoreMousePos(event)" onmousedown="MouseDown()" onmouseup="MouseUp()" onmouseleave="MouseExit()" oncontextmenu="return false;">
  <head>
  
    <script>	  
	  let size = 5;
	  let MX = 0;  // Tracks the X position of the mouse
	  let MY = 0;  // Tracks the Y position of the mouse
	  let LMDown = false;
	  let RMDown = false;
	  let bg = "images/PentagonButton.png"
	  let bgc = "images/PentagonButtonClicked.png"
	  let bgd = "images/PentagonButtonDoubled.png"
	  let bgl = "images/PentagonButtonLocked.png"
	  let bgcl = "images/PentagonButtonClickedLocked.png"
	  let xn1 = "images/BlueTile.png"      //
	  let x0 = "images/YellowTile.png"     ///
	  let x1 = "images/NormalTile.png"    ////
	  let x2 = "images/OrangeTile.png"    //// image paths for the different button types
	  let BtnWall = "images/Wall.png"    ///
	  let CycleButtons = [];
	  function CreateButton (IdNum, Type, x, y) {
	    let grid = document.getElementById("grid-container");
		let background = document.createElement('img');
	    let button = document.createElement('BUTTON');
		let img = document.createElement('img');
		let offset = "translate(" + x + "px,"+ y + "px)";
	    button.id = IdNum;
	    button.classList.add("btn");
		button.factor = 1;
		button.offsetx = x;
		button.offsety = y;
		button.walls = "";
		button.affectedButtons = [];    // stores which buttons this button will affect when pressed
		button.tabindex = -1;
  	    button.innerHTML = "0";
		button.style.color = '#0000';
		button.direction = Type;
  	    button.onmousedown = function(){BtnClick(IdNum)};
		button.oncontextmenu = function(e) {e.preventDefault();}
		button.onmouseenter = function(){BtnMouseEnter(IdNum)}; 
		button.onmouseleave = function(){BtnMouseLeave(IdNum)};
		background.id = IdNum + "bg";
		background.src = bg;
		background.classList.add("btn-background");
		img.id = IdNum + "img";
		img.src = x1;
		img.classList.add("img");
		grid.appendChild(background);
		grid.appendChild(button);
        button.style.position = "absolute";
		button.style.transform = offset;
		grid.appendChild(img);
        img.style.position = "absolute";
		img.style.transform = offset;

        background.style.position = "absolute";
		background.style.transform = offset;
		if (Type == "down") {
		  background.style.transform = offset + "rotate(180deg)";
		} else if (Type == "right") {
		  background.style.transform = offset + "rotate(90deg)";
		} else if (Type == "left") {
		  background.style.transform = offset + "rotate(270deg)";
		} else {
		  background.style.transform = offset;
		}
	  }

      function MouseDown(){
        if (event.button == 0) {
		  LMDown = true;
		}
		if (event.button == 2) {
		  RMDown= true;
		}
	  }
	  
      function MouseUp(){
        if (event.button == 0) {
		  LMDown = false;
		}
		if (event.button == 2) {
		  RMDown= false;
		}
	  }
	  
      function MouseExit(){
		LMDown = false;
		RMDown= false;
	  }
	
      function DestroyGrid (){
		if (document.body.contains(document.getElementById("grid-container")) == true){
	      document.getElementById("grid-container").remove();
        }
		CycleButtons = [];
      }		    	

      function VictoryCheck () {
	    let victory = true;
	    for (i = 1; i <= size*size; i++) {
		  if (document.getElementById(i).innerHTML != 0) {
		    victory = false;
		  }
		}
		if (victory == true) {
		  document.getElementById("new-level").innerHTML = "Victory!";
		}
	  }
	  
	  function ChangeButtonFactor (IdNum, Factor) {
	    if (Factor == -1) {
		  document.getElementById(IdNum).factor = -1;
		  document.getElementById(IdNum + "img").src = xn1;
		} else if (Factor == 0) {
		  document.getElementById(IdNum).factor = 0;
		  document.getElementById(IdNum + "img").src = x0;		
		} else if (Factor == 2) {
		  document.getElementById(IdNum).factor = 2;
		  document.getElementById(IdNum + "img").src = x2;	
		} else {
		  document.getElementById(IdNum).factor = 1;
		  document.getElementById(IdNum + "img").src = x1;		
		}
	  }
	  
	  function AddButtonWall (IdNum, String) {
	    if (String.includes("n") == true) {
		  if (document.body.contains(document.getElementById(IdNum + "nw")) == false) {
		    let nWall = document.createElement('img');
			nWall.id = IdNum + "nw"
		    nWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(nWall);
			nWall.style.position = "absolute"
			nWall.style.transform = "translate(" + document.getElementById(IdNum).offsetx + "px,"+ document.getElementById(IdNum).offsety + "px)";
		  }
		  document.getElementById(IdNum).walls = document.getElementById(IdNum).walls + "n";
		  document.getElementById(IdNum + "nw").src = BtnWall;
		}
	    if (String.includes("s") == true) {
		  if (document.body.contains(document.getElementById(IdNum + "sw")) == false) {
		    let sWall = document.createElement('img');
			sWall.id = IdNum + "sw"
		    sWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(sWall);
			sWall.style.position = "absolute"
			sWall.style.transform = "translate(" + document.getElementById(IdNum).offsetx + "px,"+ document.getElementById(IdNum).offsety + "px)" + "rotate(180deg)";

		  }
		  document.getElementById(IdNum).walls = document.getElementById(IdNum).walls + "s";
		  document.getElementById(IdNum + "sw").src = BtnWall;	
		}
	    if (String.includes("w") == true) {
		  if (document.body.contains(document.getElementById(IdNum + "ww")) == false) {
		    let wWall = document.createElement('img');
			wWall.id = IdNum + "ww"
		    wWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(wWall);
			wWall.style.position = "absolute"
			wWall.style.transform = "translate(" + document.getElementById(IdNum).offsetx + "px,"+ document.getElementById(IdNum).offsety + "px)" + "rotate(270deg)";
		  }
		  document.getElementById(IdNum).walls = document.getElementById(IdNum).walls + "w";
		  document.getElementById(IdNum + "ww").src = BtnWall;
		}
	    if (String.includes("e") == true) {
		  if (document.body.contains(document.getElementById(IdNum + "ew")) == false) {
		    let eWall = document.createElement('img');
			eWall.id = IdNum + "ew"
		    eWall.classList.add("wall");
			document.getElementById("grid-container").appendChild(eWall);
			eWall.style.position = "absolute"
			eWall.style.transform = "translate(" + document.getElementById(IdNum).offsetx + "px,"+ document.getElementById(IdNum).offsety + "px)" + "rotate(90deg)";
		  }
		  document.getElementById(IdNum).walls = document.getElementById(IdNum).walls + "e";
		  document.getElementById(IdNum + "ew").src = BtnWall;
		}
	  }
	
      function ModifyButton(IdNum,Amount){
	    let btn = document.getElementById(IdNum);
        btn.innerHTML = parseInt(btn.innerHTML) + Amount;
	    if (btn.innerHTML == 0){
		  btn.style.color = '#0000';
		}
		if (parseInt(btn.innerHTML) > 0) {
		  btn.style.color = '#404040';
		}
        if (parseInt(btn.innerHTML) < 0){
		  btn.style.color = '#A80000';
		} 
      }

      function InitializeButtonGroups()  {
	    for (let j = 1; j <= size*size; j++) {
	      let midBtn = document.getElementById(j);
          let n = 65;
          let e = 65;
          let s = 65;
          let w = 65;
		  if (midBtn.walls.includes("n")) { // the presence of a wall will limit the area on that side
		    n = 5;
		  }
		  if (midBtn.walls.includes("e")) {
		    e = 5;
		  }
		  if (midBtn.walls.includes("s")) {
		    s = 5;
		  }
		  if (midBtn.walls.includes("w")) {
		    w = 5;
		  }
	      for (let i = 1; i <= size*size; i++) {
		    let btn = document.getElementById(i);
		    if (btn.offsetx < midBtn.offsetx + e &&
		        btn.offsetx > midBtn.offsetx - w &&
			    btn.offsety < midBtn.offsety + s &&
			    btn.offsety > midBtn.offsety - n) {
              midBtn.affectedButtons.push(i);
		    }
		  }
		}
	  }
	
	  function ModifyButtonGroup (IdNum, Amount)  {
	    let btn = document.getElementById(IdNum);
        for (let i = 0; i < btn.affectedButtons.length; i++) {
		  if (btn.affectedButtons[i] == IdNum) {
		    ModifyButton (btn.affectedButtons[i], Amount*btn.factor);
		  } else {
		    ModifyButton (btn.affectedButtons[i], Amount);
		  }
		}
	  }

      function BtnClick(clickID) {
	    if (event.button == 0){
          BtnLeftClick(clickID);
		} else if (event.button == 2){
		  BtnRightClick(clickID);
		}
      }

      function BtnLeftClick(clickID)  {
        let btn = document.getElementById(clickID);
		let btnBg = document.getElementById(clickID + "bg");
		if (btn.classList.contains("btn-clicked") == false &&
		    btn.classList.contains("btn-marked") == false &&
			btn.classList.contains("btn-doubled") == false) {			
		  btn.classList.add("btn-clicked");
		  btnBg.src = bgc;
		  ModifyButtonGroup(clickID, -1);
		}
	    else if (btn.classList.contains("btn-clicked") &&
		         btn.classList.contains("btn-doubled") == false &&
				 btn.classList.contains("btn-marked") == false) {
		  btn.classList.remove("btn-clicked");
		  btn.classList.add("btn-doubled");
		  btnBg.src = bgd;
		  ModifyButtonGroup(clickID, -1);
		}
	    else if (btn.classList.contains("btn-clicked") == false &&
		         btn.classList.contains("btn-doubled") &&
				 btn.classList.contains("btn-marked") == false) {
		  btn.classList.remove("btn-doubled");
		  btnBg.src = bg;
		  ModifyButtonGroup(clickID, 2);
		}	  
		VictoryCheck();
	  }
	  
	  function BtnRightClick(clickID) {
        let btn = document.getElementById(clickID);
		let btnBg = document.getElementById(clickID + "bg");
		if (btn.classList.contains("btn-marked") == false &&
		    btn.classList.contains("btn-clicked") == false &&
			btn.classList.contains("btn-doubled") == false) {
		  btn.classList.add("btn-marked");
		  btnBg.src = bgl;
		}
	    else if (btn.classList.contains("btn-clicked") == true &&
		         btn.classList.contains("btn-marked") == false) {
		  btn.classList.add("btn-marked");
		  btnBg.src = bgcl;
		}
	    else if (btn.classList.contains("btn-doubled") == true) {
		  ModifyButtonGroup(clickID, 2);
		  btn.classList.add("btn-marked");
		  btn.classList.remove("btn-doubled");
		  btnBg.src = bgl;
		} 
		else if (btn.classList.contains("btn-marked") == true &&
		         btn.classList.contains("btn-clicked") == false) {
		  btn.classList.remove("btn-marked");
		  btnBg.src = bg;
		}	
		else if (btn.classList.contains("btn-marked") == true &&
		         btn.classList.contains("btn-clicked") == true) {
		  btn.classList.remove("btn-marked");
		  btnBg.src = bgc;
		}	
      }

      function BtnMouseEnter(clickID)  {
	    let btn = document.getElementById(clickID);
		let btnBg = document.getElementById(clickID + "bg");
	    if (LMDown == true) {
		  BtnLeftClick(clickID);
		} else if (RMDown == true) {
		  BtnRightClick(clickID);
		}
		for (i = 0; i < btn.affectedButtons.length; i++) {
		  document.getElementById(btn.affectedButtons[i]).classList.add("btn-group");
		}
		btnBg.classList.add("btn-background-hover");
	  }

      function BtnMouseLeave(clickID)  {
	    let btn = document.getElementById(clickID);
		let btnBg = document.getElementById(clickID + "bg");
		for (i = 0; i < btn.affectedButtons.length; i++) {
		  document.getElementById(btn.affectedButtons[i]).classList.remove("btn-group");
		}	 
        btnBg.classList.remove("btn-background-hover");		
	  }

      function RandomButton() {
		  let rand = Math.trunc(Math.random()*3);
		  if (rand == 0) {
		    return 0;
		  } else if (rand == 1) {
		    return 2;
		  } else if (rand == 2) {
		    return -1;
		  } else {
		    return 1
		  }
	  }

      function GenerateRandomClicks(Clicks) {
	    let clicks = Clicks;
        while (clicks > 0){
	      rand = Math.trunc(Math.random()*size*size) + 1;
		  let btn = document.getElementById(rand);
	      if (btn.classList.contains("btn-doubled") == false &&
		      btn.classList.contains("btn-marked") == false) {
            ModifyButtonGroup (rand, 1);
			if (btn.classList.contains("btn-clicked")) {
              btn.classList.add("btn-doubled");			
			}
			else {
              btn.classList.add("btn-clicked");			
			}  
		    clicks--;
          }		  
        }
	    for (let i = 1; i <= size*size; i++){
	      document.getElementById(i).classList.remove("btn-clicked", "btn-marked", "btn-doubled");
        }
	  }

      function GenerateLevel(Clicks) {
	    InitializeButtonGroups();
        GenerateRandomClicks(Clicks);
	  }
	  
      function GenerateLevelNum (Level) {
	    if (Level == 1) {                              //////////////////////////////////////////////////////////// Level 1
		  GenerateLevel (size*size/3);                 //////////////////////////////////////////////////////////// Level 1
	    } else if (Level == 2) {                       //////////////////////////////////////////////////////////// Level 2
		  GenerateLevel (size*size/1.5);                 //////////////////////////////////////////////////////////// Level 2
	    } else if (Level == 3) {                       //////////////////////////////////////////////////////////// Level 3
		  GenerateLevel (size*size);                 //////////////////////////////////////////////////////////// Level 3
		} else {
		  InitializeButtonGroups();
		}	
	  }
	  
	  function NewLevel(){
	    let i = 0;
		let type = "";
		let xOffset = 0;
		let yOffset = 0;
        DestroyGrid();
		let grid = document.createElement ('div');
		grid.id = "grid-container";
		document.getElementById("demo").appendChild(grid);
		document.getElementById("new-level").innerHTML = "New Level";
		if (parseInt(document.getElementById("level-size").value) < 3){
		  document.getElementById("level-size").value = 3;
		}
		if (parseInt(document.getElementById("level-size").value) > 30){
		  document.getElementById("level-size").value = 30;
		}
	  	size = parseInt(document.getElementById("level-size").value);  	
	    for (let y = 0; y < size; y++) {	
          for (let x = 0; x < size; x++){
            i++;	    
			
	        if (x%2 == 0 &&
			    y%2 == 0) { 
              type = "down";
			  xOffset = 0;
			  yOffset = 15;
	        } else if (x%2 == 1 &&
			           y%2 == 0) {
              type = "up";
			  xOffset = 0;
			  yOffset = -15;
	        } else if (x%2 == 0 &&
			           y%2 == 1) {
              type = "right";
			  xOffset = -30;
			  yOffset = 0;
	        } else {
              type = "left";
			   xOffset = -30;
			   yOffset = 0;
			}               
			
            if ((y)%4 == 0) {
			  if (type == "down") {
			    type = "up";
				yOffset = -15;
			  } else if (type == "up") {
			    type = "down";
				yOffset = 15;
			  }
			}
			
            if ((y-1)%4 == 0) {
			  if (type == "right") {
			    type = "left";
			  } else if (type == "left") {
			    type = "right";
			  }
			}
	          CreateButton (i, type, -30*size + 60*x + xOffset, y*45 + yOffset);
	      }  
	      x = 0;
        }	
		GenerateLevelNum (document.getElementById("level-number").value);
		document.getElementById("dummy").style.height = size*50 + "px";
      }
	  
	  function ResetClick () {
	    for (let IdNum = 1; IdNum <= size*size; IdNum++) {
		  if (document.getElementById(IdNum).classList.contains("btn-marked")){
	  	  BtnRightClick (IdNum);
	  	  }	
		  if (document.getElementById(IdNum).classList.contains("btn-clicked")){
	  	  BtnLeftClick(IdNum);
		  BtnLeftClick(IdNum);
	  	  }		
		  if (document.getElementById(IdNum).classList.contains("btn-doubled")){
	  	  BtnLeftClick(IdNum);
	  	  }	    
	    }
	  }

      function StoreMousePos (e){
        MX = e.clientX;
		MY = e.clientY;
	  }	 
 
	  function GameCycle () {
	    for ( let i = 1; i <= size*size; i++) {
		  let btn = document.getElementById(i);
		  let disable = true;
		  let wasDisabled = btn.disabled;
		  let RX = MX - btn.getBoundingClientRect().left;
		  let RY = MY - btn.getBoundingClientRect().top;
		  if (btn.direction == "up") {
		    if (RY > RX - 30 &&
		        RY > -RX + 30 &&
				RY < 60 &&
				RX > 0 &&
		        RX < 60) {
              disable = false;					
		    } 
		  } else if (btn.direction == "down") {
		    if (RY < RX + 30 &&
		        RY < -RX + 90 &&
				RY > 0 &&
				RX > 0 &&
		        RX < 60) {
              disable = false;					
		    }
		  } else if (btn.direction == "right") {
		    if (RY > RX - 30 &&
		        RY < -RX + 90 &&
				RY > 0 &&
				RY < 60 &&
		        RX > 0) {
              disable = false;					
		    }
		  } else if (btn.direction == "left") {
		    if (RY < RX + 30 &&
		        RY > -RX + 30 &&
				RY > 0 &&
				RY < 60 &&
		        RX < 60) {
              disable = false;					
		    }
		  }

		  btn.disabled = disable;
		  
		  if (wasDisabled == false &&   // Disabling/Enabling buttons causes problems with mouse exiting detection.
		      btn.disabled == true) {  // So this checks whether or not a button that was enabled is now being disabled
		    BtnMouseLeave (i);         // and calls the correct function
		  }
		}
	  }
 
	</script>
	
    <link rel="stylesheet" href="css/clickboxPentagonStyles.css">
  </head>
  <body>
    <main>
	  	  
	  <nav class="menu">
        <div>
           <span class="menu-button"><a href="index.html">Square</a></span>
		   <span class="menu-button"><a href="clickboxTriangle.html">Triangle</a></span>
		   <span><strong>Pentagon</strong></span>
		   <span class="menu-button"><a href="clickboxHexagon.html">Hexagon</a></span>
        </div>
      </nav>	  
	  
	  
	<div id="demo" class="demo">
	  <div>
	    <input type="number" class="level-number" id="level-number" value="1" min="1" max="3">
	    <button class="new-level" id="new-level" onclick="NewLevel()" >New Level</button>
	    <input type="number" class="level-size" id="level-size" value="5" min="3" max="30">
	  </div>
      <div><button class="reset" onclick="ResetClick()">Reset</button></div>
	</div>
	<div id="dummy"></div>
	
	  
    </main>
	
	
	<script>

	NewLevel();
	let interval = setInterval(GameCycle, 20)
	  
	</script>  	
	
	
  </body>
</html>
